[Unit]
Description=HSPC Sandbox Manager Server

[Service]
User={{hosting_username}}
TimeoutStartSec=infinity
WorkingDirectory={{hosting_user_home}}/sandman

ExecStart={{java_home}}/bin/java \
 -Xms{{sandman_server_initial_memory}} \
 -Xmx{{sandman_server_max_memory}} \
 -Dserver.port={{sandman_server_port}} \
 -Dserver.host={{sandman_server_host}} \
 -Dspring.datasource.url={{mysql_url}}/{{sandman_server_database}}?autoReconnect=true \
 -Dspring.datasource.username={{mysql_username}} \
 -Dspring.datasource.password={{mysql_password}} \
 -Dspring.jpa.hibernate.ddl-auto={{sandman_server_ddl_auto}} \
 -Dhspc.platform.authorization.url={{auth_server_external_url}} \
 -Dhspc.platform.authorization.adminAccess.clientId={{sandman_server_oauth_admin_access_client_id}} \
 -Dhspc.platform.authorization.adminAccess.clientSecret={{sandman_server_oauth_admin_access_client_secret}} \
 -Dhspc.platform.api.version1.baseUrl={{api_stu3_server_external_url}} \
 -Dhspc.platform.authorization.baseUrl={{auth_server_external_url}} \
 -Dhspc.platform.defaultSandboxCreatorRoles={{sandman_server_defaultSandboxCreatorRoles}} \
 -Dhspc.platform.defaultSystemRoles={{sandman_server_defaultSystemRoles}} \
 -Dhspc.platform.defaultPrivateSandboxRoles={{sandman_server_defaultPrivateSandboxRoles}} \
 -Dhspc.platform.defaultSandboxVisibility={{sandman_server_defaultSandboxVisibility}} \
 -Dhspc.platform.defaultPublicSandboxRoles={{sandman_server_defaultPublicSandboxRoles}} \
 -Dhspc.platform.jwt.key={{hspc_platform_jwt_key}} \
 -Dhspc.platform.messaging.baseUrl={{messaging_server_external_url}}/ \
 -Dhspc.platform.messaging.sendEmail={{sandman_server_send_email}} \
 -DenvInfo.active=true \
 -DhspcEnv=prod \
 -DdefaultServiceUrl={{api_server_default_sandbox_url}} \
 -DbaseServiceUrl_1={{api_stu3_server_external_url}}/ \
 -DuserManagementUrl={{account_server_external_url}} \
 -DsbmUrlHasContextPath=false \
 -DoauthLogoutUrl={{auth_server_external_url}}/logout \
 -DpersonaCookieDomain={{auth_server_persona_cookie_domain}} \
 -DhostOrg=null \
{% if use_secure_http %}
 -Dserver.ssl.key-store={{hosting_user_home}}/keystore \
 -Dserver.ssl.key-store-password={{keystore_password}} \
 -Dserver.ssl.keyStoreType=JKS \
{% endif %}
 -jar {{sandman_server_artifact_artifact_id}}-{{sandman_server_artifact_version}}.{{sandman_server_artifact_packaging}}
Restart=always

[Install]
WantedBy=multi-user.target
